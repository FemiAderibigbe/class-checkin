<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Portal</title>
    <style>
        :root { --primary: #2563eb; --bg: #f3f4f6; --card: #ffffff; }
        body { font-family: system-ui, -apple-system, sans-serif; background-color: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        .container { background: var(--card); padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); width: 100%; max-width: 400px; text-align: center; }
        h1 { color: var(--primary); margin-top: 0; }
        
        .form-group { margin-bottom: 15px; text-align: left; }
        label { display: block; margin-bottom: 5px; font-weight: 600; color: #374151; font-size: 0.9rem; }
        input { width: 93%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; outline: none; }
        input:focus { border-color: var(--primary); }
        
        button { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; background-color: var(--primary); color: white; font-size: 1rem; margin-top: 10px; }
        button:disabled { background-color: #9ca3af; cursor: not-allowed; }
        
        #status { margin-top: 15px; font-size: 0.9rem; min-height: 20px; }
        .success { color: #10b981; }
        .error { color: #ef4444; }
    </style>
</head>
<body>

<div class="container">
    <h1>Class Check-In</h1>

    <div class="form-group">
        <label>Lecture Name</label>
        <input type="text" id="lectureInput" placeholder="e.g. Pathology 101" required>
    </div>

    <div class="form-group">
        <label>Full Name</label>
        <input type="text" id="nameInput" placeholder="John Doe" required>
    </div>

    <div class="form-group">
        <label>Matric No / Code</label>
        <input type="text" id="codeInput" placeholder="Enter ID" required>
    </div>

    <button id="submitBtn" onclick="sendData()">Submit Attendance</button>
    <div id="status"></div>
</div>

<script>
    const lectureField = document.getElementById('lectureInput');
    const nameField = document.getElementById('nameInput');
    const codeField = document.getElementById('codeInput');
    const btn = document.getElementById('submitBtn');
    const statusDiv = document.getElementById('status');

    // !!! PASTE YOUR GOOGLE SCRIPT URL BELOW !!!
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz9E4tov3UVqrUUrCm4YTM0xoj-PaRF923-eU0gfb0DeWQN8jKj_HrdWY4PGmQvx1Ld-g/exec"; 

    function sendData() {
        const lecture = lectureField.value.trim();
        const name = nameField.value.trim();
        const code = codeField.value.trim();

        if (!lecture || !name || !code) {
            statusDiv.innerHTML = "<span class='error'>Please fill in all fields.</span>";
            return;
        }

        btn.disabled = true;
        btn.innerText = "Processing...";
        statusDiv.innerText = "";

        // Capture IP for security (optional but recommended)
        fetch('https://api.ipify.org?format=json')
        .then(response => response.json())
        .then(data => {
            submitToGoogle(lecture, name, code, data.ip, navigator.userAgent);
        })
        .catch(() => {
            submitToGoogle(lecture, name, code, "Unknown", navigator.userAgent);
        });
    }

    function submitToGoogle(lecture, name, code, ip, device) {
        fetch(SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                lecture: lecture, 
                name: name,
                code: code, 
                ip: ip,
                device: device
            })
        }).then(() => {
            statusDiv.innerHTML = "<span class='success'>Success! " + name + " recorded.</span>";
            
            // Clear Name and Code, but keep Lecture Name (easier for next student if shared device)
            nameField.value = '';
            codeField.value = '';
            
            nameField.focus(); // Focus back to name for next entry
            btn.disabled = false;
            btn.innerText = "Submit Attendance";
        }).catch(err => {
            statusDiv.innerHTML = "<span class='error'>Failed to send. Check connection.</span>";
            btn.disabled = false;
            btn.innerText = "Submit Attendance";
        });
    }
</script>

</body>
</html>
